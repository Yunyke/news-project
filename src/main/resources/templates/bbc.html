<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>BBC æœ€æ–°æ–°è</title>

<!-- Bootstrap & è‡ªè¨‚æ¨£å¼ -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">

</head>
<style>
body {
	margin: 0;
	padding: 0;
	background-color: #f8f9fa;
	font-family: Arial, sans-serif;
}

.header-title {
	font-family: 'Playfair Display', serif;
	font-weight: 700;
	font-size: 6rem;
	text-align: center;
	margin-top: 20px;
	color: #000;
	letter-spacing: 0.05em;
	font-style: normal;
}

.nav-link:hover {
	color: #ffcc00 !important;
	background-color: #333333;
	border-radius: 5px;
	transition: background-color 0.3s ease, color 0.3s ease;
}

.grid-container {
	padding: 20px;
	background-color: #f8f9fa;
	display: block;
}

.news-section {
	margin-bottom: 30px; /* é¡¯ç¤ºå€å¡Šé–“çš„é–“è· */
	background-color: #f0f0f0; /* è¨­ç½®èƒŒæ™¯è‰² */
	padding: 20px; /* å‘å³åç§»ï¼Œé€™è£¡çš„40pxæœƒè®“å€å¡Šæ›´é å³ */
	border-radius: 8px; /* åœ“è§’æ•ˆæœ */
}

h2.news-section-title {
	margin-bottom: 20px; /* æ¸›å°‘æ¨™é¡Œèˆ‡å¡ç‰‡ä¹‹é–“çš„ç©ºé–“ */
	text-align: left; /* ç¢ºä¿æ¨™é¡Œå·¦å°é½Š */
	margin-left: 15px; /* å¢åŠ å·¦è¾¹è·ï¼Œå‘å³åç§» */
}

/* æ–°èå€å¡Šçš„æ’åˆ— */
.news-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 80px;
  align-items: start;
  
  max-width: 1400px;             /* âœ… é™åˆ¶æ•´å€‹ grid æœ€å¤§å¯¬åº¦ */
  margin: 0 auto;                /* âœ… è®“æ•´å€‹ grid æ°´å¹³ç½®ä¸­ */
  padding: 0 20px;             
}

/* å¡ç‰‡æ¨£å¼èª¿æ•´ */
.news-card {
	background-color: #f7f7f7;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	border-radius: 8px;
	cursor: pointer;
	display: flex;
	flex-direction: row;
	padding: 10px;
	position: relative; /* è®“ tooltip å¯ä»¥å®šä½ */
	transition: background-color 0.3s ease;
	margin: 10px;
	height: 135px;
	width: 110%;
	max-width: none;
         /* ç”¨ grid gap æ§é–“è·å°±å¥½ */
}
.hover-description {
	display: none;
	position: absolute;
	background-color: rgba(50, 50, 50, 0.9);
	color: #fff;
	padding: 10px;
	border-radius: 6px;
	font-size: 0.9rem;
	max-width: 500px;
	z-index: 999;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
	top: 100%; /* å‡ºç¾åœ¨å¡ç‰‡ä¸‹æ–¹ */
	left: 0;
	white-space: normal;
}

.news-card:hover .hover-description {
	display: block;
}

.news-img {
	width: auto;
	height: auto;
	object-fit: contain;
	max-width: 45%;
	max-height: 100px;
	flex-shrink: 0;
	border-radius: 6px;
	margin-right: 15px;
	margin-top: 5px;
}

/* æ–‡å­—å…§å®¹å€ */
.news-content {
	padding-top: 5px; /* âœ… è¼•å¾®ä¸Šé‚Šè·æ§åˆ¶é–“è· */
	padding-bottom: 20px; /* âœ… ä¿ç•™åº•éƒ¨ç©ºé–“çµ¦æ™‚é–“ */
	display: flex;
	flex-direction: column;
	justify-content: flex-start;
	flex-grow: 1;
	max-height: 120px;
	overflow: hidden; /* é˜²æ­¢æ–‡å­—æº¢å‡º */
}

/* æ¨™é¡ŒåŠ å¤§ä¸¦æ›è¡Œ */
.news-title {
	font-weight: 700;
	font-size: 0.8rem;
	margin: 0 0 8px 0;
	word-wrap: break-word;
	line-height: 1.2;
	overflow: visible;
	text-overflow: normal; /* è¶…éç¯„åœé¡¯ç¤ºçœç•¥è™Ÿ */
	white-space: normal; /* å…è¨±æ¨™é¡Œæ›è¡Œ */
	max-height: 2.4em;
	padding-right: 80px; /* âœ… é ç•™æŒ‰éˆ•ä½ç½® */
	padding-left: 2px; /* âœ… æ¸›ä¸€é»å·¦å³ç©ºé–“ï¼Œè®“ title ç•™æ›´å¤šè¡Œ */
}

.news-time {
	position: absolute;
	bottom: 10px;
	right: 15px;
	font-size: 0.8rem;
	color: #888;
}

/* æ‘˜è¦é™åˆ¶æœ€å¤šä¸‰è¡Œï¼Œå¤šçš„é¡¯ç¤º... */
.news-desc {
	flex-grow: 1;
	overflow: hidden;
	display: -webkit-box;
	-webkit-line-clamp: 3; /* é™åˆ¶æœ€å¤šé¡¯ç¤ºä¸‰è¡Œ */
	-webkit-box-orient: vertical;
	text-overflow: ellipsis;
	margin: 0 0 8px 0;
	color: #444;
	font-size: 0.9rem;
}

/* æ¨™ç±¤èˆ‡åˆ†é¡ */
.news-tags {
	font-size: 0.8rem;
	color: #666;
	margin-top: auto;
}

.add-to-cart-btn {
	position: absolute;
	top: 10px;
	right: 10px;
	z-index: 10;
	font-size: 0.75rem;
	padding: 4px 10px;
	background-color: #ffffff;
	color: #333;
	border: 1px solid #aaa;
	border-radius: 20px;
	box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.1);
	transition: all 0.2s ease;
}

.star-button {
	background: none;
	border: none;
	cursor: pointer;
	padding: 0;
}

.news-item {
	position: relative;
	padding: 1rem;
	border-bottom: 1px solid #ccc;
}

.star-form {
	position: absolute;
	top: 0.5rem;
	right: 0.5rem;
}

.star-button {
	position: absolute;
	top: 0;
	right: -24px; /* å‡¸å‡ºå³å´ç´„ä¸€åŠå¯¬åº¦ */
	width: 32px; /* âœ… æ›¸ç±¤çš„å¯¬åº¦ */
	height: 36px; /* âœ… æ›¸ç±¤çš„é«˜åº¦ï¼Œæ¯”å­—é«”ç¨é•·ï¼Œåƒæ¨™ç±¤ç´™ */
	background-color: rgba(255, 105, 180, 0.6); /* âœ… åŠé€æ˜ hotpink */
	border: none;
	border-top-right-radius: 8px;
	border-bottom-right-radius: 8px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 1rem;
	cursor: pointer;
	z-index: 1; /* âœ… è®“å®ƒã€Œè¢«è“‹ä½ã€ï¼Œéƒ¨åˆ†è—åœ¨å¡ç‰‡åº•ä¸‹ */
	box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.15);
	backdrop-filter: blur(2px);
	transition: transform 0.2s ease;
}

.star {
	color: white;
	transition: color 0.3s, transform 0.2s;
}

.star.filled {
	color: gray; /* å¯ä»¥æ›æˆ crimsonã€deeppinkã€red çœ‹ä½ å–œæ­¡å“ªç¨® */
}

.cnn-card .news-title {
	font-size: 0.95rem;
	line-height: 1.2;
	margin: 0;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	padding-right: 60px; /* ç‚ºå³ä¸Šè§’çš„ â• é ç•™ç©ºé–“ */
}

body {
	top: 0 !important;
}

.custom-auth-btn {
	background-color: transparent !important; /* èƒŒæ™¯é€æ˜ */
	border: 1px solid white; /* ç™½è‰²é‚Šæ¡† */
	color: black !important;
	transition: all 0.3s ease;
}

.custom-auth-btn:hover {
	background-color: white !important;
	color: black !important; /* æ»‘éè®Šåè‰² */
}
</style>
<body>

	<div class="container-fluid px-4 mt-4" style="max-width: 1600px; margin: auto;">
		<h1 class="mb-4">BBC æ–°è</h1>

		<div class="news-grid">
			<div th:each="news : ${newsList}"
				th:if="${news != null and news.title != null and news.title != ''}"
				class="news-card">

				<!-- åŠ å…¥æ¸…å–®æŒ‰éˆ• -->
				<button class="btn btn-sm btn-outline-primary add-to-cart-btn"
					th:attr="data-id=${news.id}">â•</button>

				<!-- æ–°èå¡ç‰‡å…§å®¹ -->
				<a th:href="${news.url}" target="_blank"
					style="text-decoration: none;">
					<div style="display: flex;">
						<img th:if="${news.imageUrl != null}" th:src="${news.imageUrl}"
							class="news-img" />
						<div class="news-content">
							<h5 class="news-title" th:text="${news.title}">æ¨™é¡Œ</h5>
							<p class="hover-description" th:text="${news.description}">æ‘˜è¦</p>
							<p class="news-time"
								th:text="${#temporals.format(news.publishedAt, 'yyyy-MM-dd HH:mm')}">æ™‚é–“</p>
						</div>
					</div>
				</a>
			</div>
		</div>
	</div>

	<!-- å³ä¸‹è§’æŸ¥çœ‹æ¸…å–® -->
	<a href="#" class="btn btn-warning position-fixed bottom-0 end-0 m-4"
		style="z-index: 999;" onclick="handleViewCartClick()"> ğŸ“° æŸ¥çœ‹æ–°èæ¸…å–® <span
		id="cart-count" class="badge bg-dark ms-1"></span>
	</a>
	<!-- âœ… å°šæœªç™»å…¥æ™‚é¡¯ç¤ºç™»å…¥/è¨»å†Š -->
	<div th:if="${session.name == null}"
		style="position: absolute; top: 5px; right: 20px; z-index: 1050; background-color: #f8f9fa; padding: 5px 10px; border-radius: 8px; color: #6c757d;">
		<a class="btn btn-sm btn-outline-light me-2 custom-auth-btn"
			th:href="@{/login}" style="color: #6c757d;">ç™»å…¥</a> <a
			class="btn btn-sm btn-outline-light custom-auth-btn"
			th:href="@{/register}" style="color: #6c757d;">è¨»å†Š</a>
	</div>

	<!-- âœ… å·²ç™»å…¥æ™‚é¡¯ç¤ºæ­¡è¿è©å’Œç™»å‡º -->
	<div th:if="${session.name != null}"
		style="position: absolute; top: 5px; right: 20px; z-index: 1050; background-color: #f8f9fa; padding: 5px 10px; border-radius: 8px; color: #6c757d;">
		<span class="text-warning me-2"> æ­¡è¿ï½<strong
			th:text="${session.name}" style="color: #6c757d;">ä½¿ç”¨è€…</strong>
		</span> <a id="logoutBtn" class="btn btn-sm btn-outline-light me-2"
			th:href="@{/logout}" style="color: #6c757d;">ç™»å‡º</a>
	</div>

	<!-- å¯é¸ï¼šå…±ç”¨çš„è³¼ç‰©è»Š JS -->
	<script th:src="@{/js/cart.js}"></script>
	<script th:inline="javascript">
  window.USER_SESSION = {
    isLoggedIn: /*[[${session.name != null}]]*/ false,
    userId: /*[[${session.userId}]]*/ null,
    name: /*[['${session.name}']]*/ ''
  };
  window.IS_LOGGED_IN = /*[[${session.name != null}]]*/ false;
</script>
	<script>
  document.addEventListener("DOMContentLoaded", async function () {
    if (!window.IS_LOGGED_IN) {
      localStorage.removeItem("newsCart");
    }

    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("resetCart") === "true") {
      localStorage.removeItem("newsCart");
      const cleanUrl = window.location.origin + window.location.pathname;
      window.history.replaceState({}, document.title, cleanUrl);
    }

    let cart = JSON.parse(localStorage.getItem("newsCart") || "[]");

    if (window.IS_LOGGED_IN) {
      try {
        const res = await fetch(`/api/cart/users/${window.USER_SESSION.userId}/cart`);
        if (res.ok) {
          const serverIds = await res.json();
          cart = Array.from(new Set([...cart, ...serverIds]));
          localStorage.setItem("newsCart", JSON.stringify(cart));
        }
      } catch (err) {
        console.error("âš ï¸ é›²ç«¯æ¸…å–®è®€å–å¤±æ•—ï¼š", err);
      }
    }

    document.querySelectorAll(".add-to-cart-btn").forEach(btn => {
      const id = parseInt(btn.dataset.id, 10);
      const card = btn.closest(".news-card");

      if (cart.includes(id)) {
        card.classList.add("added-to-cart");
        btn.innerText = "âœ… å·²åŠ å…¥";
      }

      btn.addEventListener("click", function (event) {
        event.stopPropagation();
        if (!window.IS_LOGGED_IN) {
          alert("è«‹å…ˆç™»å…¥æ‰èƒ½åŠ å…¥æ–°èæ¸…å–®ï¼");
          return;
        }

        const userId = window.USER_SESSION.userId;
        if (!userId) {
          alert("ç„¡æ³•è¾¨è­˜ä½¿ç”¨è€… IDï¼Œè«‹é‡æ–°ç™»å…¥");
          return;
        }

        if (!cart.includes(id)) {
          cart.push(id);
          card.classList.add("added-to-cart");
          btn.innerText = "âœ… å·²åŠ å…¥";
          fetch(`/api/cart/users/${userId}/cart`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ newsId: id })
          });
        } else {
          cart = cart.filter(itemId => itemId !== id);
          card.classList.remove("added-to-cart");
          btn.innerText = "â•";
          fetch(`/api/cart/users/${userId}/cart/${id}`, { method: "DELETE" });
        }

        localStorage.setItem("newsCart", JSON.stringify(cart));
        updateCartCount();
      });
    });

    updateCartCount();
  });

  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("newsCart") || "[]");
    const badge = document.getElementById("cart-count");
    if (badge) {
      badge.innerText = cart.length;
      badge.style.display = cart.length === 0 ? "none" : "inline-block";
    }
  }

  document.getElementById("logoutBtn")?.addEventListener("click", function (e) {
    e.preventDefault();
    localStorage.removeItem("newsCart");
    updateCartCount();
    window.location.href = "/logout";
  });

  function handleViewCartClick() {
    if (!window.IS_LOGGED_IN) {
      alert("è«‹å…ˆç™»å…¥æ‰èƒ½æŸ¥çœ‹æ–°èæ¸…å–®ï¼");
      return;
    }
    window.location.href = "/cart";
  }
</script>

</body>
</html>
